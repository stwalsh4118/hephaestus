# [6-3] Docker Network Management

[Back to task list](./tasks.md)

## Description

Implement creation and management of a shared Docker bridge network for all simulator containers. All managed containers will join this network, enabling inter-container communication using hostnames.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 06:18:07 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. Create a shared Docker bridge network named `heph-network` (constant `NetworkName`)
2. Network creation must be idempotent — if the network already exists, reuse it
3. Provide `CreateNetwork(ctx)` method that creates the bridge network
4. Provide `RemoveNetwork(ctx)` method that removes the network
5. Network removal must handle the case where containers are still connected (disconnect first or error gracefully)
6. Implement as part of the orchestrator implementation struct (e.g., `DockerOrchestrator`)
7. Store the network ID for later reference

## Implementation Plan

1. Create `backend/internal/docker/engine.go` with `DockerOrchestrator` struct holding the Docker client and network ID
2. Constructor `NewDockerOrchestrator(client)` that takes the client wrapper from 6-1
3. Implement `CreateNetwork(ctx)`: call Docker API `NetworkCreate` with bridge driver, check for existing network first via `NetworkList` with name filter
4. Implement `RemoveNetwork(ctx)`: call Docker API `NetworkRemove`, handle "not found" gracefully
5. Compile-time interface assertion: `var _ Orchestrator = (*DockerOrchestrator)(nil)` (will initially fail since not all methods are implemented — use stub methods returning `ErrNotImplemented`)

## Test Plan

- Unit test: `CreateNetwork` calls Docker API with correct parameters (mock Docker client interface)
- Unit test: `CreateNetwork` is idempotent — second call reuses existing network
- Unit test: `RemoveNetwork` handles "network not found" without error
- Integration: actual Docker network creation/removal tested in 6-7

## Verification

_To be completed during implementation._

## Files Modified

_To be completed during implementation._
