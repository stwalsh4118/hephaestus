# [3-1] Service Type Definitions & Constants

[Back to task list](./tasks.md)

## Description

Define the 5 MVP service types (API Service, PostgreSQL, Redis, Nginx, RabbitMQ) with their TypeScript interfaces, configuration schemas, colour/icon constants, and updated palette items. This replaces the current 4 generic types (service, worker, database, queue) with the concrete service types specified in the PRD.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-18 09:47:52 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. Define a `ServiceType` union: `"api-service" | "postgresql" | "redis" | "nginx" | "rabbitmq"`
2. Define per-service config interfaces:
   - `ApiServiceConfig`: `endpoints: Endpoint[]`, `port: number`
   - `PostgresqlConfig`: `engine: string`, `version: string`
   - `RedisConfig`: `maxMemory: string`, `evictionPolicy: string`
   - `NginxConfig`: `upstreamServers: string[]`
   - `RabbitMQConfig`: `vhost: string`
3. Define `Endpoint` interface: `{ method: HttpMethod, path: string, responseSchema: string }`
4. Define `HttpMethod` union: `"GET" | "POST" | "PUT" | "DELETE" | "PATCH"`
5. Define colour and icon constants per service type (icon text abbreviations for now; icon library integration deferred)
6. Update `PALETTE_ITEMS` to contain the 5 MVP service types with descriptions matching the PRD
7. Update `CanvasNodeData` to include an optional `config` field typed as a discriminated union of service configs
8. Maintain backward compatibility with existing React Flow integration

## Implementation Plan

1. Update `frontend/src/types/canvas.ts`:
   - Replace `NodeType` with `ServiceType` union
   - Add `Endpoint`, `HttpMethod`, and per-service config interfaces
   - Add `ServiceConfig` discriminated union type
   - Update `CanvasNodeData` to include optional `config` field
   - Update `PaletteItem` to use `ServiceType`
2. Update `frontend/src/constants/canvas.ts`:
   - Replace `PALETTE_ITEMS` with 5 MVP service types
   - Add `SERVICE_COLORS` map (service type → hex colour)
   - Add `SERVICE_ICONS` map (service type → icon abbreviation)
   - Add `SERVICE_LABELS` map (service type → display label)
3. Update `frontend/src/store/canvas-store.ts`: Update `AddNodeInput` to reference new types
4. Update `frontend/src/components/palette/ComponentPalette.tsx`: Adapt to new `PaletteItem` shape if needed
5. Update `frontend/src/components/canvas/DiagramCanvas.tsx`: Update drop handler to use `ServiceType`

## Test Plan

- TypeScript compilation passes without errors
- Existing E2E tests (pbi2-cos.spec.js) still pass (palette item count will change from 4 to 5)
- Verify all 5 service types are present in palette via updated E2E test assertion

## Verification

_To be completed during implementation._

## Files Modified

_To be completed during implementation._
