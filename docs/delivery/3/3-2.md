# [3-2] Custom React Flow Node Components

[Back to task list](./tasks.md)

## Description

Create visually distinct custom React Flow node components for each of the 5 service types. Each node displays its service icon, label, and a colour-coded header/border. Register the custom node types with the React Flow `nodeTypes` prop so they render instead of default nodes.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-18 09:47:52 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-18 09:59:52 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-18 10:03:10 | Status Change | InProgress | Review | Implementation complete, internal AI review passed | AI_Agent |

## Requirements

1. Create a `ServiceNode` component (or per-type components) that renders:
   - Colour-coded header bar with service icon abbreviation
   - Service label (user-editable name or default)
   - Connection handles (source and target)
   - Visual distinction at a glance (different background colour per type)
2. Register custom node types in `DiagramCanvas.tsx` via the `nodeTypes` prop
3. Update the `addNode` flow to set the correct React Flow `type` field matching the registered custom node type
4. Nodes must support React Flow's built-in drag, selection, and resize behaviours

## Implementation Plan

1. Create `frontend/src/components/canvas/nodes/ServiceNode.tsx` — a shared custom node component that reads `data.type` to apply service-specific styling (colour, icon from constants)
2. Create `frontend/src/components/canvas/nodes/index.ts` — exports `nodeTypes` map for React Flow registration
3. Update `DiagramCanvas.tsx`:
   - Import and pass `nodeTypes` to `<ReactFlow>`
   - Update `onDrop` handler to set `type: "service-node"` (or per-type key) on created nodes
4. Style nodes using Tailwind classes with inline colour overrides from `SERVICE_COLORS`

## Test Plan

- TypeScript compilation passes
- Each of the 5 service types renders with correct colour and icon when dropped onto canvas
- Nodes remain draggable and selectable
- Connection handles are visible and functional
- Visual inspection via Playwright snapshot

## Verification

- TypeScript compilation: PASS
- ESLint: PASS
- Prettier: PASS
- E2E test (pbi2-cos.spec.js): PASS
- Internal AI review: PASS (0 critical, 0 high, 3 medium — 2 fixed, 1 deferred pre-existing nodeCounter issue from PBI-2; 4 low — deferred)

## Files Modified

- `frontend/src/components/canvas/nodes/ServiceNode.tsx` — NEW: Custom React Flow node component
- `frontend/src/components/canvas/nodes/index.ts` — NEW: nodeTypes map and NODE_TYPE_SERVICE constant
- `frontend/src/components/canvas/DiagramCanvas.tsx` — Added nodeTypes prop to ReactFlow
- `frontend/src/store/canvas-store.ts` — Changed node type from "default" to NODE_TYPE_SERVICE
