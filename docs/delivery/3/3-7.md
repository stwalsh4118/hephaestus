# [3-7] E2E CoS Test

[Back to task list](./tasks.md)

## Description

Automated end-to-end tests that verify all PBI-3 acceptance criteria are met. Uses Playwright to exercise the full user flow: palette → drag → canvas → select → configure → verify persistence.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-18 09:47:52 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

Verify all 6 acceptance criteria:

1. **AC1**: 5 service types available in the palette (API Service, PostgreSQL, Redis, Nginx, RabbitMQ)
2. **AC2**: Each service type has a distinct visual appearance (icon and colour)
3. **AC3**: Clicking a node opens a configuration side panel
4. **AC4**: API Service configuration includes an endpoint editor (method, path, response schema)
5. **AC5**: Database (PostgreSQL) configuration includes engine and version selection
6. **AC6**: Configuration changes persist to the diagram state

## Implementation Plan

1. Create `frontend/tests/e2e/pbi3-cos.spec.ts` with Playwright test suite
2. Test scenarios:
   - **AC1**: Verify palette contains exactly 5 items with correct labels
   - **AC2**: Drag each type onto canvas, verify nodes have distinct colours/icons via snapshot or attribute checks
   - **AC3**: Click a node, verify config panel appears; click canvas, verify panel closes
   - **AC4**: Drop API Service node, open config, add an endpoint (set method, path, schema), verify fields persist
   - **AC5**: Drop PostgreSQL node, open config, verify engine/version dropdowns, change version, verify persists
   - **AC6**: Configure a node, deselect, re-select, verify config values are retained
3. Update PBI-2 E2E tests if palette count assertion changed (4 → 5)

## Test Plan

### Objectives
Validate all PBI-3 Conditions of Satisfaction through automated browser tests.

### Test Scope
- Palette content and service type availability
- Custom node visual rendering
- Config panel open/close behaviour
- API Service endpoint editor functionality
- PostgreSQL config form functionality
- Config state persistence across selection changes

### Environment & Setup
- Dev server running via `pnpm dev`
- Playwright browser automation
- No backend dependency (frontend-only features)

### Key Scenarios

| # | Scenario | Steps | Expected Result |
|---|----------|-------|-----------------|
| 1 | Palette has 5 service types | Load page, inspect palette | 5 items: API Service, PostgreSQL, Redis, Nginx, RabbitMQ |
| 2 | Nodes are visually distinct | Drag all 5 types onto canvas | Each node has unique colour and icon |
| 3 | Config panel opens on click | Click a node | Panel slides in with correct service type |
| 4 | Config panel closes | Click canvas background | Panel disappears |
| 5 | API endpoint editor | Select API node, add endpoint | Method/path/schema fields present and editable |
| 6 | PostgreSQL config | Select PG node | Engine and version dropdowns present |
| 7 | Config persistence | Configure node, deselect, re-select | Config values retained |

### Success Criteria
- All 7 scenarios pass
- No console errors during test execution

## Verification

_To be completed during implementation._

## Files Modified

_To be completed during implementation._
