# [4-1] Edge Types, Constants & Store Extensions

[Back to task list](./tasks.md)

## Description

Define TypeScript types and constants for edge connections, and extend the Zustand canvas store with edge creation, validation, and label editing capabilities. This is the foundational task — all other PBI-4 tasks depend on these definitions.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-18 11:49:11 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. Define a `CanvasEdgeData` interface with a `label` field (string, default empty)
2. Update `CanvasEdge` type alias to use `Edge<CanvasEdgeData>`
3. Add named constants for edge defaults (e.g., default edge type key, default label)
4. Add `onConnect(connection: Connection): void` action to the canvas store that creates a new edge with a generated ID
5. `onConnect` must validate against duplicate edges: reject if an edge with the same source+target already exists
6. Add `updateEdgeLabel(edgeId: string, label: string): void` action to the canvas store
7. Add `removeEdge(edgeId: string): void` action to the canvas store

## Implementation Plan

### Files to Create/Modify

- **Modify** `frontend/src/types/canvas.ts` — Add `CanvasEdgeData` interface, update `CanvasEdge` type
- **Modify** `frontend/src/constants/canvas.ts` — Add edge-related constants
- **Modify** `frontend/src/store/canvas-store.ts` — Add `onConnect`, `updateEdgeLabel`, `removeEdge` actions; update edges typing

### Steps

1. In `types/canvas.ts`:
   - Add `CanvasEdgeData` interface: `{ label: string }`
   - Change `CanvasEdge` from `Edge` to `Edge<CanvasEdgeData>`
2. In `constants/canvas.ts`:
   - Add `EDGE_TYPE_LABELED = "labeled-edge"` constant
   - Add `EDGE_DEFAULT_LABEL = ""` constant
3. In `store/canvas-store.ts`:
   - Import `Connection` from `@xyflow/react`
   - Add `onConnect`, `updateEdgeLabel`, `removeEdge` to the store interface and implementation
   - `onConnect`: generate edge ID (e.g., `edge-${nanoid()}`), check for duplicate source+target, create edge with `CanvasEdgeData`
   - `updateEdgeLabel`: find edge by ID, update its `data.label`
   - `removeEdge`: filter edge out of edges array

## Test Plan

- TypeScript compilation passes without errors
- Unit verify: calling `onConnect` with a valid connection adds an edge to the store
- Unit verify: calling `onConnect` with a duplicate source+target does NOT add a second edge
- Unit verify: `updateEdgeLabel` changes the label on the correct edge
- Unit verify: `removeEdge` removes the edge from the array

## Verification

_To be completed during implementation._

## Files Modified

_To be completed during implementation._
