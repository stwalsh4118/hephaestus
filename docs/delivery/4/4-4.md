# [4-4] Topology JSON Export

[Back to task list](./tasks.md)

## Description

Implement a function that exports the current diagram state (nodes, edges, positions, configs) as a JSON document conforming to the PRD Diagram JSON Schema. Add an Export button to the canvas toolbar that triggers a file download.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-18 11:49:11 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. Create an `exportDiagram` function that maps canvas store state to the PRD JSON schema:
   ```json
   {
     "id": "<generated-uuid>",
     "name": "Untitled Diagram",
     "nodes": [{ "id", "type", "name", "position": { "x", "y" }, "config" }],
     "edges": [{ "id", "source", "target", "label" }]
   }
   ```
2. Node `type` in export should use the service type string (e.g., `"api-service"`), not the React Flow node type
3. Node `name` maps from `data.label`
4. Edge `label` maps from `data.label` (empty string if unset)
5. Add an Export button to the canvas UI (toolbar area)
6. Clicking Export triggers a JSON file download (e.g., `diagram.json`)
7. The exported JSON must be valid and parseable

## Implementation Plan

### Files to Create/Modify

- **Create** `frontend/src/lib/topology.ts` — `exportDiagram` and `importDiagram` (export portion in this task)
- **Modify** `frontend/src/components/canvas/DiagramWorkspace.tsx` — Add Export button to toolbar area

### Steps

1. Create `lib/topology.ts`:
   - Define `DiagramJson` interface matching the PRD schema
   - Implement `exportDiagram(nodes, edges)` → returns `DiagramJson`
   - Implement `downloadDiagram(diagram: DiagramJson)` — creates a Blob, generates object URL, triggers `<a>` click download
2. In `DiagramWorkspace.tsx`:
   - Add an Export button in the toolbar/header area
   - On click: read store state, call `exportDiagram`, call `downloadDiagram`

### Dependencies

- Requires working edges from task 4-3 (to have edge data to export)
- Requires store types from task 4-1

## Test Plan

- TypeScript compilation passes
- `exportDiagram` correctly maps nodes with positions, types, names, and configs
- `exportDiagram` correctly maps edges with source, target, and label
- Export produces valid JSON matching the PRD schema structure
- Export button is visible in the UI
- Clicking Export triggers a file download

## Verification

_To be completed during implementation._

## Files Modified

_To be completed during implementation._
