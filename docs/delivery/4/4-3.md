# [4-3] Canvas Edge Integration

[Back to task list](./tasks.md)

## Description

Wire edge connection handling into the `DiagramCanvas` component: register the custom edge type, connect the `onConnect` callback to the store, and enable users to draw edges between nodes by dragging from handles.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-18 11:49:11 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-18 12:03:34 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-18 12:06:14 | Status Change | InProgress | Review | Implementation complete, internal AI review passed | AI_Agent |
| 2026-02-18 13:39:47 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

1. Import and pass `edgeTypes` to the React Flow `<ReactFlow>` component
2. Wire the store's `onConnect` handler to the `<ReactFlow>` `onConnect` prop
3. Edges drawn by the user should use the `EDGE_TYPE_LABELED` type by default
4. Set `defaultEdgeOptions` with `type: EDGE_TYPE_LABELED` and initial `data: { label: "" }`
5. Verify edge drawing works: dragging from a source handle to a target handle creates a visible edge with arrow

## Implementation Plan

### Files to Modify

- **Modify** `frontend/src/components/canvas/DiagramCanvas.tsx` — Add `edgeTypes`, `onConnect`, `defaultEdgeOptions`

### Steps

1. Import `edgeTypes` from `./edges`
2. Import `EDGE_TYPE_LABELED` from constants and `EDGE_DEFAULT_LABEL` from constants
3. Get `onConnect` from `useCanvasStore`
4. Add `edgeTypes={edgeTypes}` prop to `<ReactFlow>`
5. Add `onConnect={onConnect}` prop to `<ReactFlow>`
6. Add `defaultEdgeOptions={{ type: EDGE_TYPE_LABELED, data: { label: EDGE_DEFAULT_LABEL } }}` to `<ReactFlow>`

### Dependencies

- Requires store extensions from task 4-1
- Requires edge component from task 4-2

## Test Plan

- TypeScript compilation passes
- Dragging from a source handle to a target handle creates an edge
- Created edge uses the labeled edge type (has arrow, label capability)
- Attempting to create a duplicate edge (same source → target) is prevented
- Edge state is reflected in the store's edges array

## Verification

- TypeScript compilation passes (`pnpm tsc --noEmit` — zero errors)
- ESLint passes (`pnpm lint` — zero warnings)
- Internal AI review: pass (0 critical, 0 high, 0 medium, 2 low — acceptable)

## Files Modified

- `frontend/src/components/canvas/DiagramCanvas.tsx` — Added edgeTypes, onConnect, defaultEdgeOptions to ReactFlow
