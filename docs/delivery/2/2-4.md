# [2-4] Build Base React Flow Canvas Component

[Back to task list](./tasks.md)

## Description

Create the core React Flow canvas component that occupies the main viewport area. This component renders the interactive canvas with background grid, minimap, zoom/pan controls, and wires into the Zustand store for state management. Replace the placeholder landing page with the canvas as the main application view.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-18 07:33:26 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-18 07:52:02 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-18 08:06:01 | Status Change | InProgress | Review | Implementation complete, internal AI review passed | AI_Agent |
| 2026-02-18 08:53:44 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

1. Create a `DiagramCanvas` component wrapping `<ReactFlow>` from `@xyflow/react`
2. Canvas must fill the main viewport area (full height minus any chrome)
3. Include `<Background>` component with dot or grid pattern for alignment reference
4. Include `<MiniMap>` component in a corner for orientation on large diagrams
5. Include `<Controls>` component for zoom-in, zoom-out, and fit-to-view buttons
6. Canvas must support zoom via scroll wheel and pan via background drag (React Flow defaults)
7. Connect to Zustand store: read nodes/edges, wire `onNodesChange`/`onEdgesChange` handlers
8. Nodes must be repositionable by dragging
9. Selected nodes must show visual highlight (React Flow default behavior)
10. Import React Flow CSS stylesheet
11. Update the main page (`frontend/src/app/page.tsx`) to render the canvas as the primary view
12. Wrap the app with `<ReactFlowProvider>` as needed

## Implementation Plan

1. Create `frontend/src/components/canvas/DiagramCanvas.tsx`
2. Import and render `<ReactFlow>` with `<Background>`, `<MiniMap>`, `<Controls>`
3. Connect to canvas store via Zustand selectors for nodes, edges, and change handlers
4. Apply React Flow's required CSS import
5. Create a layout wrapper component if needed for full-viewport sizing
6. Update `frontend/src/app/page.tsx` to render the `DiagramCanvas` component
7. Ensure `ReactFlowProvider` wraps the component tree

**Dependencies**: Task 2-2 (types), Task 2-3 (store)

## Test Plan

- TypeScript compilation passes without errors
- Canvas renders in the browser without console errors
- Background grid/dots are visible
- MiniMap is visible in a corner
- Controls (zoom in/out/fit) are visible and functional
- Scroll wheel zooms the canvas
- Click-drag on background pans the canvas
- Browser verification via Playwright: navigate to `/`, confirm canvas renders with background and controls

## Verification

- Added `frontend/src/components/canvas/DiagramCanvas.tsx` with:
  - `<ReactFlow>` rendering from store-managed nodes/edges
  - `<Background>` with dot pattern
  - `<MiniMap>` and `<Controls>`
  - zoom bounds and viewport wiring to Zustand store
- Added `frontend/src/components/canvas/DiagramWorkspace.tsx` to wrap the canvas with `<ReactFlowProvider>` and place palette + canvas side-by-side.
- Updated `frontend/src/app/page.tsx` to render `DiagramWorkspace` as the main view.
- Imported React Flow stylesheet in `DiagramCanvas` (`@xyflow/react/dist/style.css`).
- Ran `pnpm test` (`tsc --noEmit`) in `frontend/`; type check passed.
- Browser verification (Playwright):
  - Started frontend with `pnpm dev --hostname 127.0.0.1 --port 3100`.
  - Captured page snapshot with `pnpm dlx playwright screenshot --wait-for-timeout=3000 http://127.0.0.1:3100 /tmp/pbi2-4.png`.
  - Verified screenshot shows canvas viewport, dot background, minimap, zoom controls, and left palette layout.
- Internal AI review verdict: `pass`.

## Files Modified

- `frontend/src/components/canvas/DiagramCanvas.tsx`
- `frontend/src/components/canvas/DiagramWorkspace.tsx`
- `frontend/src/app/page.tsx`
- `docs/delivery/2/2-4.md`
- `docs/delivery/2/tasks.md`
