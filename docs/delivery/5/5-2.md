# 5-2: File-Based Diagram Storage

[Back to task list](./tasks.md)

## Description

Implement a file-based JSON storage layer that persists diagrams as individual JSON files on disk. Provides Create, Get, and Update operations. Diagrams must survive server restarts (AC5). Uses a storage interface so the implementation can be swapped later (e.g., to SQLite) without changing handler code.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 04:38:28 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. `DiagramStore` interface with `Create`, `Get`, and `Update` methods
2. `FileStore` implementation that:
   - Stores each diagram as `<id>.json` in a configurable directory
   - Generates UUIDs for new diagrams on `Create`
   - Returns the created diagram with assigned ID from `Create`
   - Returns a descriptive "not found" error from `Get`/`Update` when ID doesn't exist
   - Creates the storage directory on first use if it doesn't exist
3. Thread-safe for concurrent access (mutex)
4. Storage directory configurable (default: `./data/diagrams`)

## Implementation Plan

1. Create `backend/internal/storage/store.go` with `DiagramStore` interface
2. Create `backend/internal/storage/filestore.go` with `FileStore` implementation
3. Add `google/uuid` dependency for ID generation
4. Write unit tests in `backend/internal/storage/filestore_test.go` using a temp directory

## Test Plan

- Create a diagram → returns diagram with generated UUID
- Get a created diagram by ID → returns matching diagram
- Update an existing diagram → persisted changes are readable
- Get with non-existent ID → returns not-found error
- Update with non-existent ID → returns not-found error
- Files survive "restart" (new FileStore instance reads previously created files)
- Concurrent Create calls don't corrupt storage

## Verification

_To be completed during implementation._

## Files Modified

_To be completed during implementation._
