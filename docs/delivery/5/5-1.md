# 5-1: Diagram Model Types and Validation

[Back to task list](./tasks.md)

## Description

Define Go struct types that mirror the frontend's `DiagramJson` schema (see `frontend/src/lib/topology.ts` and `docs/api-specs/frontend/canvas-api.md`). Implement a validation function that rejects malformed diagram payloads with descriptive errors. These types and validation form the foundation used by storage and handler layers.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 04:38:28 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. Go structs for `Diagram`, `DiagramNode`, `DiagramEdge`, and `ServiceConfig` variants matching the frontend schema
2. `ServiceConfig` must support all 5 service types: `api-service`, `postgresql`, `redis`, `nginx`, `rabbitmq`
3. Validation function that checks:
   - Required fields are present (id, name, nodes, edges)
   - Node fields are valid (id, type, name, position with x/y)
   - Edge fields are valid (id, source, target, label)
   - Service type is one of the 5 allowed values
4. Validation returns structured errors indicating what failed
5. Types must use JSON struct tags for proper serialization/deserialization

## Implementation Plan

1. Create `backend/internal/model/diagram.go` with struct definitions
2. Create `backend/internal/model/validation.go` with `ValidateDiagram()` function
3. Write unit tests in `backend/internal/model/diagram_test.go`

## Test Plan

- Valid diagram JSON unmarshals correctly into Go structs
- Round-trip marshaling preserves all fields
- Validation passes for a well-formed diagram
- Validation fails with descriptive error for: missing ID, missing name, empty nodes type, invalid service type, missing node position, missing edge source/target

## Verification

_To be completed during implementation._

## Files Modified

_To be completed during implementation._
