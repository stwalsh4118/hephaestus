# 5-4: Diagram CRUD HTTP Handlers

[Back to task list](./tasks.md)

## Description

Implement the REST API handlers for diagram Create, Read, and Update. Wire routes into the server mux using Go 1.22+ method-based routing patterns. Handlers use the `DiagramStore` interface from task 5-2 and the diagram types/validation from task 5-1.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 04:38:28 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. `POST /api/diagrams` — accepts diagram JSON body, validates, creates via store, returns `201 Created` with `{"id": "<uuid>"}`
2. `GET /api/diagrams/{id}` — retrieves diagram by ID, returns `200 OK` with diagram JSON; returns `404 Not Found` if missing
3. `PUT /api/diagrams/{id}` — accepts diagram JSON body, validates, updates via store, returns `200 OK` with updated diagram; returns `404 Not Found` if missing
4. All error responses use consistent JSON format: `{"error": "<message>"}`
5. Request body validation returns `400 Bad Request` with validation error details
6. Content-Type must be `application/json` for all responses
7. Routes registered on the existing `http.ServeMux` in `main.go`
8. Update `docs/api-specs/backend/backend-api.md` with new endpoints

## Implementation Plan

1. Create `backend/internal/handler/diagram.go` with handler functions
2. Create shared JSON response helpers (e.g., `writeJSON`, `writeError`) in `backend/internal/handler/response.go`
3. Update `backend/cmd/server/main.go` to instantiate `FileStore` and register diagram routes
4. Write integration tests in `backend/internal/handler/diagram_test.go` using `httptest`
5. Update backend API spec document

## Test Plan

- POST with valid diagram → 201 + response contains generated ID
- POST with invalid JSON → 400 + error message
- POST with failing validation → 400 + validation error details
- GET with existing ID → 200 + correct diagram
- GET with non-existent ID → 404 + error message
- PUT with valid update → 200 + updated diagram
- PUT with non-existent ID → 404 + error message
- PUT with invalid body → 400 + error message
- All responses have `Content-Type: application/json`

## Verification

_To be completed during implementation._

## Files Modified

_To be completed during implementation._
