# 5-3: CORS Middleware

[Back to task list](./tasks.md)

## Description

Add CORS middleware to the Go HTTP server so the frontend dev server (running on a different port) can make cross-origin requests. Handle preflight OPTIONS requests and set appropriate headers for all responses.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 04:38:28 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-19 04:49:25 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-19 04:50:52 | Status Change | InProgress | Review | Implementation complete, internal AI review passed | AI_Agent |
| 2026-02-19 05:32:09 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

1. CORS middleware function that wraps `http.Handler`
2. Sets headers: `Access-Control-Allow-Origin`, `Access-Control-Allow-Methods`, `Access-Control-Allow-Headers`
3. Allowed origin configurable via environment variable `CORS_ORIGIN` (default: `http://localhost:3000`)
4. Allowed methods: `GET, POST, PUT, DELETE, OPTIONS`
5. Allowed headers: `Content-Type, Authorization`
6. Handles preflight `OPTIONS` requests with `204 No Content`
7. Wire middleware into the server in `main.go`

## Implementation Plan

1. Create `backend/internal/middleware/cors.go` with `CORS()` middleware function
2. Write unit tests in `backend/internal/middleware/cors_test.go`
3. Update `backend/cmd/server/main.go` to wrap the mux with CORS middleware

## Test Plan

- Response includes `Access-Control-Allow-Origin` header matching configured origin
- OPTIONS request returns 204 with correct CORS headers
- Non-OPTIONS requests pass through to handler with CORS headers added
- Default origin is `http://localhost:3000` when `CORS_ORIGIN` env var is unset

## Verification

- All 4 unit tests pass
- `go vet` clean
- `golangci-lint` clean (0 issues)
- Build passes
- Internal AI review: pass

## Files Modified

- `backend/internal/middleware/cors.go` — CORS middleware with configurable origin
- `backend/internal/middleware/cors_test.go` — 4 unit tests
- `backend/cmd/server/main.go` — Wired CORS middleware into server handler
